name: Actualizar archivos del sistema de Tecon

on:
    workflow_dispatch:
        inputs:
          downloadLatest:
            description: 'Descargar la última versión de los archivos del sistema'
            type: boolean
            required: false
            default: true
          url:
            description: 'URL del repositorio de Tecon'
            required: true
            default: ''

jobs:
  update-tecon-system-files:
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
        with:
          token: ${{ secrets.ghTokenWorkflow }}

      - name: clonar repo y comparar
        run: |
          git clone --depth=1 ${{ github.event.inputs.url }} teconRepo
          if (git diff --no-index teconRepo/.github .github){
            Write-Warning "Hay cambios en los archivos del sistema de Tecon"
            Remove-Item .github -Recurse -Force
            Copy-Item -Recurse -Force teconRepo/.github .github

            git config --global user.name 'github-actions[bot]'
            git config --global user.email 'github-actions[bot]@users.noreply.github.com'
            Remove-Item -Recurse -Force teconRepo
            git add .
            git commit -m "Actualizar archivos del sistema de Tecon desde ${{ github.event.inputs.url }}"
            git push origin main
          }else{
            Write-Host "No hay cambios en los archivos del sistema de Tecon"
          }
      

    